!/bin/bash

test -e $SNAP_DATA/extra_flags || echo 'FLAGS=""' > $SNAP_DATA/extra_flags

# Fail if these vars are not present (e.g. from direct wrapper runs)
: ${SNAP?} ${SNAP_DATA?}
# get args
. $SNAP_DATA/extra_flags
cp -pn $SNAP/etc/vmagent-scrape-config.yaml $SNAP_DATA/vmagent-scrape-config.yaml
$SNAP/bin/vmagent -remoteWrite.url 127.0.0.1:8428 -remoteWrite.tmpDataPath /var/lib/vmagent-remotewrite-data -promscrape.config /etc/vmagent-scrape-config.yaml $FLAGS